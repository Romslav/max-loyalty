import { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\n\nexport interface Notification {\n  id: string;\n  type:\n    | 'points_added'\n    | 'points_redeemed'\n    | 'card_created'\n    | 'guest_registered'\n    | 'system'\n    | 'admin_alert';\n  title: string;\n  message: string;\n  data?: Record<string, any>;\n  read: boolean;\n  timestamp: number;\n  priority?: 'low' | 'medium' | 'high' | 'critical';\n}\n\nexport interface Toast {\n  id: string;\n  type: 'success' | 'error' | 'info' | 'warning';\n  title: string;\n  message: string;\n  duration?: number;\n  action?: {\n    label: string;\n    onClick: () => void;\n  };\n}\n\ninterface SystemEvent {\n  type: 'connected' | 'disconnected' | 'error' | 'info' | 'warning';\n  message: string;\n  timestamp: number;\n}\n\nexport interface NotificationState {\n  // Notifications (persistent)\n  notifications: Notification[];\n  unreadCount: number;\n\n  // Toasts (temporary UI)\n  toasts: Toast[];\n\n  // System events\n  systemEvents: SystemEvent[];\n\n  // Settings\n  isEnabled: boolean;\n  soundEnabled: boolean;\n  emailNotifications: boolean;\n\n  // Stats\n  stats: {\n    pointsAdded: number;\n    pointsRedeemed: number;\n    cardsCreated: number;\n  };\n\n  // Actions - Notifications\n  addNotification: (notification: Notification) => void;\n  markAsRead: (id: string) => void;\n  markAllAsRead: () => void;\n  deleteNotification: (id: string) => void;\n  clearNotifications: () => void;\n  getUnreadNotifications: () => Notification[];\n\n  // Actions - Toasts\n  showNotification: (toast: Omit<Toast, 'id'>) => void;\n  hideNotification: (id: string) => void;\n  clearToasts: () => void;\n\n  // Actions - System Events\n  addSystemEvent: (event: SystemEvent) => void;\n  clearSystemEvents: () => void;\n\n  // Actions - Settings\n  toggleNotifications: () => void;\n  toggleSound: () => void;\n  toggleEmailNotifications: () => void;\n  setEmailNotifications: (enabled: boolean) => void;\n\n  // Actions - Stats\n  incrementPointsAdded: (amount: number) => void;\n  incrementPointsRedeemed: (amount: number) => void;\n  incrementCardsCreated: () => void;\n}\n\nexport const useNotificationStore = create<NotificationState>()(\n  devtools(\n    (set, get) => ({\n      notifications: [],\n      unreadCount: 0,\n      toasts: [],\n      systemEvents: [],\n      isEnabled: true,\n      soundEnabled: true,\n      emailNotifications: false,\n      stats: {\n        pointsAdded: 0,\n        pointsRedeemed: 0,\n        cardsCreated: 0,\n      },\n\n      // Notification actions\n      addNotification: (notification) => {\n        set((state) => ({\n          notifications: [notification, ...state.notifications],\n          unreadCount: state.unreadCount + 1,\n        }));\n\n        // Play sound if enabled\n        if (get().soundEnabled) {\n          playNotificationSound();\n        }\n      },\n\n      markAsRead: (id) => {\n        set((state) => {\n          const notification = state.notifications.find((n) => n.id === id);\n          if (!notification || notification.read) return state;\n\n          return {\n            notifications: state.notifications.map((n) =>\n              n.id === id ? { ...n, read: true } : n\n            ),\n            unreadCount: Math.max(state.unreadCount - 1, 0),\n          };\n        });\n      },\n\n      markAllAsRead: () => {\n        set((state) => ({\n          notifications: state.notifications.map((n) => ({\n            ...n,\n            read: true,\n          })),\n          unreadCount: 0,\n        }));\n      },\n\n      deleteNotification: (id) => {\n        set((state) => {\n          const notification = state.notifications.find((n) => n.id === id);\n          const wasUnread = notification && !notification.read;\n\n          return {\n            notifications: state.notifications.filter((n) => n.id !== id),\n            unreadCount: wasUnread\n              ? Math.max(state.unreadCount - 1, 0)\n              : state.unreadCount,\n          };\n        });\n      },\n\n      clearNotifications: () => {\n        set({\n          notifications: [],\n          unreadCount: 0,\n        });\n      },\n\n      getUnreadNotifications: () => {\n        return get().notifications.filter((n) => !n.read);\n      },\n\n      // Toast actions\n      showNotification: (toast) => {\n        const id = Date.now().toString();\n        const toastWithId: Toast = { ...toast, id };\n\n        set((state) => ({\n          toasts: [...state.toasts, toastWithId],\n        }));\n\n        // Auto-hide after duration\n        if (toast.duration) {\n          setTimeout(() => get().hideNotification(id), toast.duration);\n        }\n      },\n\n      hideNotification: (id) => {\n        set((state) => ({\n          toasts: state.toasts.filter((t) => t.id !== id),\n        }));\n      },\n\n      clearToasts: () => {\n        set({ toasts: [] });\n      },\n\n      // System events\n      addSystemEvent: (event) => {\n        set((state) => ({\n          systemEvents: [event, ...state.systemEvents].slice(0, 50),\n        }));\n      },\n\n      clearSystemEvents: () => {\n        set({ systemEvents: [] });\n      },\n\n      // Settings\n      toggleNotifications: () => {\n        set((state) => ({\n          isEnabled: !state.isEnabled,\n        }));\n      },\n\n      toggleSound: () => {\n        set((state) => ({\n          soundEnabled: !state.soundEnabled,\n        }));\n      },\n\n      toggleEmailNotifications: () => {\n        set((state) => ({\n          emailNotifications: !state.emailNotifications,\n        }));\n      },\n\n      setEmailNotifications: (enabled) => {\n        set({ emailNotifications: enabled });\n      },\n\n      // Stats\n      incrementPointsAdded: (amount) => {\n        set((state) => ({\n          stats: {\n            ...state.stats,\n            pointsAdded: state.stats.pointsAdded + amount,\n          },\n        }));\n      },\n\n      incrementPointsRedeemed: (amount) => {\n        set((state) => ({\n          stats: {\n            ...state.stats,\n            pointsRedeemed: state.stats.pointsRedeemed + amount,\n          },\n        }));\n      },\n\n      incrementCardsCreated: () => {\n        set((state) => ({\n          stats: {\n            ...state.stats,\n            cardsCreated: state.stats.cardsCreated + 1,\n          },\n        }));\n      },\n    }),\n    {\n      name: 'notification-store',\n    }\n  )\n);\n\n/**\n * Play notification sound\n */\nfunction playNotificationSound(): void {\n  try {\n    // Create audio context for sound\n    const audioContext = new (window.AudioContext ||\n      (window as any).webkitAudioContext)();\n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n\n    oscillator.connect(gainNode);\n    gainNode.connect(audioContext.destination);\n\n    // Bell sound: two tones\n    oscillator.frequency.value = 800;\n    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(\n      0.01,\n      audioContext.currentTime + 0.3\n    );\n\n    oscillator.start(audioContext.currentTime);\n    oscillator.stop(audioContext.currentTime + 0.3);\n  } catch (err) {\n    console.error('[Notification] Failed to play sound:', err);\n  }\n}\n