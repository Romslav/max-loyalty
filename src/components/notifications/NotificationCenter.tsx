import { useState } from 'react';\nimport { useNotificationStore } from '@stores/notificationStore';\n\ninterface NotificationCenterProps {\n  isOpen?: boolean;\n  onClose?: () => void;\n}\n\nfunction NotificationItem({\n  notification,\n  onMarkAsRead,\n  onDelete,\n}: {\n  notification: any;\n  onMarkAsRead: (id: string) => void;\n  onDelete: (id: string) => void;\n}) {\n  const typeEmoji = {\n    points_added: 'üéâ',\n    points_redeemed: '‚ú®',\n    card_created: 'üí≥',\n    guest_registered: 'üë§',\n    admin_alert: '‚ö†Ô∏è',\n    system: '‚ÑπÔ∏è',\n  }[notification.type] || 'üîî';\n\n  const priorityColor = {\n    low: 'border-l-4 border-l-blue-400',\n    medium: 'border-l-4 border-l-yellow-400',\n    high: 'border-l-4 border-l-orange-400',\n    critical: 'border-l-4 border-l-red-500',\n  }[notification.priority || 'medium'] || '';\n\n  const timestamp = new Date(notification.timestamp).toLocaleString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n  });\n\n  return (\n    <div\n      className={`\n        p-3 border-b border-gray-200 dark:border-gray-700\n        hover:bg-gray-50 dark:hover:bg-gray-800\n        transition cursor-pointer\n        ${!notification.read ? 'bg-blue-50 dark:bg-blue-900/20' : ''}\n        ${priorityColor}\n        flex gap-3\n      `}\n      onClick={() => !notification.read && onMarkAsRead(notification.id)}\n    >\n      <div className="text-2xl flex-shrink-0 mt-1">{typeEmoji}</div>\n\n      <div className="flex-1 min-w-0">\n        <div className="flex items-start justify-between gap-2">\n          <h4 className="font-semibold text-sm text-gray-900 dark:text-white">\n            {notification.title}\n          </h4>\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              onDelete(notification.id);\n            }}\n            className="\n              text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\n              transition flex-shrink-0\n            "\n            aria-label="Delete"\n          >\n            ‚úï\n          </button>\n        </div>\n\n        <p className="text-sm text-gray-600 dark:text-gray-400 mt-1 break-words">\n          {notification.message}\n        </p>\n\n        <time className="text-xs text-gray-500 dark:text-gray-500 mt-2 block">\n          {timestamp}\n        </time>\n      </div>\n\n      {!notification.read && (\n        <div className="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2"></div>\n      )}\n    </div>\n  );\n}\n\nexport function NotificationCenter({\n  isOpen: externalIsOpen,\n  onClose: externalOnClose,\n}: NotificationCenterProps = {}) {\n  const [isOpen, setIsOpen] = useState(externalIsOpen ?? false);\n  const notifications = useNotificationStore((state) => state.notifications);\n  const unreadCount = useNotificationStore((state) => state.unreadCount);\n  const markAsRead = useNotificationStore((state) => state.markAsRead);\n  const markAllAsRead = useNotificationStore((state) => state.markAllAsRead);\n  const deleteNotification = useNotificationStore(\n    (state) => state.deleteNotification\n  );\n\n  const handleClose = () => {\n    setIsOpen(false);\n    externalOnClose?.();\n  };\n\n  const handleOpen = () => {\n    setIsOpen(true);\n  };\n\n  const handleToggle = () => {\n    setIsOpen(!isOpen);\n  };\n\n  return (\n    <div className="relative">\n      {/* Bell Icon Button */}\n      <button\n        onClick={handleToggle}\n        className="\n          relative p-2\n          hover:bg-gray-100 dark:hover:bg-gray-800\n          rounded-lg transition\n          focus:outline-none focus:ring-2 focus:ring-blue-500\n        "\n        aria-label="Notifications"\n        aria-expanded={isOpen}\n      >\n        <svg\n          className="w-6 h-6 text-gray-700 dark:text-gray-300"\n          fill="none"\n          stroke="currentColor"\n          viewBox="0 0 24 24"\n        >\n          <path\n            strokeLinecap="round"\n            strokeLinejoin="round"\n            strokeWidth={2}\n            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"\n          />\n        </svg>\n\n        {/* Notification Badge */}\n        {unreadCount > 0 && (\n          <span\n            className="\n              absolute top-0 right-0\n              inline-flex items-center justify-center\n              px-1.5 py-0.5\n              text-xs font-bold\n              text-white\n              bg-red-600\n              rounded-full\n              transform translate-x-1/2 -translate-y-1/2\n              min-w-[20px]\n            "\n          >\n            {unreadCount > 99 ? '99+' : unreadCount}\n          </span>\n        )}\n      </button>\n\n      {/* Dropdown Panel */}\n      {isOpen && (\n        <>\n          {/* Overlay */}\n          <div\n            className="fixed inset-0 z-40"\n            onClick={handleClose}\n            aria-hidden="true"\n          />\n\n          {/* Panel */}\n          <div\n            className="\n              absolute right-0 mt-2\n              w-96 max-w-[calc(100vw-16px)]\n              bg-white dark:bg-gray-900\n              rounded-lg shadow-xl border border-gray-200 dark:border-gray-800\n              z-50\n              max-h-96\n              overflow-hidden\n              flex flex-col\n              animate-in fade-in zoom-in-95\n              origin-top-right\n              duration-200\n            "\n          >\n            {/* Header */}\n            <div className="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-800 flex-shrink-0 bg-gray-50 dark:bg-gray-800/50">\n              <h3 className="font-semibold text-lg text-gray-900 dark:text-white">\n                Notifications\n              </h3>\n              {unreadCount > 0 && (\n                <button\n                  onClick={() => {\n                    markAllAsRead();\n                  }}\n                  className="\n                    text-sm text-blue-600 dark:text-blue-400\n                    hover:text-blue-700 dark:hover:text-blue-300\n                    transition font-medium\n                  "\n                >\n                  Mark all as read\n                </button>\n              )}\n            </div>\n\n            {/* Notification List */}\n            <div className="overflow-y-auto flex-1">\n              {notifications.length === 0 ? (\n                <div className="p-8 text-center text-gray-500 dark:text-gray-400">\n                  <svg\n                    className="w-12 h-12 mx-auto mb-3 opacity-50"\n                    fill="none"\n                    stroke="currentColor"\n                    viewBox="0 0 24 24"\n                  >\n                    <path\n                      strokeLinecap="round"\n                      strokeLinejoin="round"\n                      strokeWidth={2}\n                      d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"\n                    />\n                  </svg>\n                  <p>No notifications yet</p>\n                </div>\n              ) : (\n                <div>\n                  {notifications.map((notification) => (\n                    <NotificationItem\n                      key={notification.id}\n                      notification={notification}\n                      onMarkAsRead={markAsRead}\n                      onDelete={deleteNotification}\n                    />\n                  ))}\n                </div>\n              )}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n